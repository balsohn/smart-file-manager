plugins {
    id 'java'
    id 'application'
    id 'org.openjfx.javafxplugin' version '0.1.0'
    id 'com.github.johnrengelman.shadow' version '8.1.1'
}

group = 'com.smartfilemanager'
version = '1.0.0'
sourceCompatibility = '17'
targetCompatibility = '17'

// ì¸ì½”ë”© ì„¤ì •
compileJava.options.encoding = 'UTF-8'
compileTestJava.options.encoding = 'UTF-8'

// JavaFX ì„¤ì • - ë²„ì „ì„ ëª…ì‹œí•˜ê³  ëŸ°íƒ€ì„ í¬í•¨
javafx {
    version = '17.0.2'  // JDK 17ê³¼ í˜¸í™˜ë˜ëŠ” ë²„ì „
    modules = ['javafx.controls', 'javafx.fxml', 'javafx.graphics', 'javafx.base']
    configuration = 'implementation'  // ëŸ°íƒ€ì„ì—ë„ í¬í•¨
}

repositories {
    mavenCentral()
}

dependencies {
    // JavaFX ëŸ°íƒ€ì„ ì˜ì¡´ì„± ëª…ì‹œì  ì¶”ê°€ (ëª¨ë“  í”Œë«í¼ í¬í•¨)
    implementation "org.openjfx:javafx-controls:17.0.2"
    implementation "org.openjfx:javafx-fxml:17.0.2"
    implementation "org.openjfx:javafx-graphics:17.0.2"
    implementation "org.openjfx:javafx-base:17.0.2"

    // í¬ë¡œìŠ¤ í”Œë«í¼ ì§€ì›ì„ ìœ„í•œ ë„¤ì´í‹°ë¸Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤
    implementation "org.openjfx:javafx-controls:17.0.2:win"
    implementation "org.openjfx:javafx-fxml:17.0.2:win"
    implementation "org.openjfx:javafx-graphics:17.0.2:win"
    implementation "org.openjfx:javafx-base:17.0.2:win"
    
    implementation "org.openjfx:javafx-controls:17.0.2:linux"
    implementation "org.openjfx:javafx-fxml:17.0.2:linux"
    implementation "org.openjfx:javafx-graphics:17.0.2:linux"
    implementation "org.openjfx:javafx-base:17.0.2:linux"
    
    implementation "org.openjfx:javafx-controls:17.0.2:mac"
    implementation "org.openjfx:javafx-fxml:17.0.2:mac"
    implementation "org.openjfx:javafx-graphics:17.0.2:mac"
    implementation "org.openjfx:javafx-base:17.0.2:mac"

    // Lombok
    compileOnly 'org.projectlombok:lombok:1.18.30'
    annotationProcessor 'org.projectlombok:lombok:1.18.30'

    // JSON ì²˜ë¦¬
    implementation 'com.google.code.gson:gson:2.10.1'

    // SQLite
    implementation 'org.xerial:sqlite-jdbc:3.44.1.0'

    // ë¡œê¹…
    implementation 'org.slf4j:slf4j-api:2.0.9'
    implementation 'ch.qos.logback:logback-classic:1.4.14'

    // í…ŒìŠ¤íŠ¸
    testImplementation 'org.junit.jupiter:junit-jupiter:5.10.1'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}

// ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
application {
    mainClass = 'com.smartfilemanager.Launcher'
}

// í…ŒìŠ¤íŠ¸ ì„¤ì •
test {
    useJUnitPlatform()
}

// ì†ŒìŠ¤ì…‹ ì„¤ì •
sourceSets {
    test {
        java {
            srcDirs = ['src/test/java']
        }
        resources {
            srcDirs = ['src/test/resources']
        }
    }
}

// ğŸ§ª í†µê³„ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ íƒœìŠ¤í¬ (JavaFX ìˆ˜ì •)
task statisticsTest(type: JavaExec) {
    group = 'verification'
    description = 'í†µê³„ ì‹œìŠ¤í…œì„ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤'

    dependsOn 'compileJava', 'compileTestJava'

    classpath = sourceSets.main.runtimeClasspath + sourceSets.test.runtimeClasspath
    mainClass = 'com.smartfilemanager.test.StatisticsSystemTest'

    // JavaFX ëª¨ë“ˆ ê²½ë¡œ ì„¤ì •
    def javafxModules = [
            'javafx.controls',
            'javafx.fxml',
            'javafx.graphics',
            'javafx.base'
    ]

    // JVM ì¸ìˆ˜ ìˆ˜ì •
    jvmArgs = [
            '--module-path', classpath.asPath,
            '--add-modules', javafxModules.join(','),
            '-Dfile.encoding=UTF-8',
            '-Djava.awt.headless=false'
    ]

    systemProperties = [
            'test.mode': 'full',
            'test.data.size': '186'
    ]

    doFirst {
        println ""
        println "ğŸ§ª Smart File Manager - Statistics System Test"
        println "=" * 55
        println "ğŸ”§ JavaFX Runtime: Included via Gradle"
        println "ğŸ“Š Testing statistics with ${systemProperties['test.data.size']} virtual files"
        println "ğŸ¯ Test window will open - check all tabs and features"
        println ""
    }

    doLast {
        println ""
        println "ğŸ‰ Statistics test completed!"
    }
}

// ë¹ ë¥¸ í†µê³„ í…ŒìŠ¤íŠ¸
task quickStatsTest(type: JavaExec) {
    group = 'verification'
    description = 'í†µê³„ ì‹œìŠ¤í…œ ë¹ ë¥¸ ê²€ì¦ (ì†ŒëŸ‰ ë°ì´í„°)'

    dependsOn 'compileJava', 'compileTestJava'

    classpath = sourceSets.main.runtimeClasspath + sourceSets.test.runtimeClasspath
    mainClass = 'com.smartfilemanager.test.StatisticsSystemTest'

    jvmArgs = [
            '--module-path', classpath.asPath,
            '--add-modules', 'javafx.controls,javafx.fxml,javafx.graphics,javafx.base',
            '-Dfile.encoding=UTF-8'
    ]

    systemProperties = [
            'test.mode': 'quick',
            'test.data.size': '50'
    ]
}

// í†µê³„ íŒŒì¼ ê²€ì¦ íƒœìŠ¤í¬
task verifyStatisticsFiles {
    group = 'verification'
    description = 'í†µê³„ ì‹œìŠ¤í…œ í•„ìˆ˜ íŒŒì¼ ì¡´ì¬ í™•ì¸'

    doLast {
        def requiredFiles = [
                'src/main/java/com/smartfilemanager/controller/StatisticsController.java',
                'src/main/resources/fxml/statistics.fxml',
                'src/main/resources/css/statistics-styles.css'
        ]

        def missing = []
        requiredFiles.each { file ->
            if (!project.file(file).exists()) {
                missing.add(file)
            }
        }

        if (missing.empty) {
            println "âœ… All statistics system files exist"
        } else {
            println "âš ï¸  Some files missing (will use basic test):"
            missing.each { file ->
                println "   - $file"
            }
        }
    }
}

// í†µê³„ í…ŒìŠ¤íŠ¸ìš© íŒŒì¼ ìƒì„±
task createTestFile {
    group = 'build setup'
    description = 'í†µê³„ í…ŒìŠ¤íŠ¸ íŒŒì¼ì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤'

    doLast {
        // ê¸°ì¡´ ë¬¸ì œê°€ ìˆëŠ” íŒŒì¼ë“¤ ì •ë¦¬
        def utilDir = file('src/test/java/com/smartfilemanager/util')
        if (utilDir.exists()) {
            utilDir.deleteDir()
            println "ğŸ§¹ Cleaned problematic util directory"
        }

        // ì˜¬ë°”ë¥¸ í…ŒìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ ìƒì„±
        def testDir = file('src/test/java/com/smartfilemanager/test')
        testDir.mkdirs()

        def testFile = file('src/test/java/com/smartfilemanager/test/StatisticsSystemTest.java')

        // ê¸°ì¡´ íŒŒì¼ì´ ìˆë‹¤ë©´ ì‚­ì œí•˜ê³  ìƒˆë¡œ ìƒì„±
        if (testFile.exists()) {
            testFile.delete()
            println "ğŸ”„ Replaced existing test file"
        }

        // ê¹¨ë—í•œ í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
        testFile.text = '''package com.smartfilemanager.test;

import javafx.application.Application;
import javafx.scene.Scene;
import javafx.scene.control.Label;
import javafx.scene.layout.VBox;
import javafx.stage.Stage;

/**
 * Clean Statistics System Test
 * Basic JavaFX test with proper runtime
 */
public class StatisticsSystemTest extends Application {

    @Override
    public void start(Stage primaryStage) {
        System.out.println("ğŸš€ Statistics System Test Started!");
        
        VBox root = new VBox(15);
        root.getChildren().addAll(
            new Label("ğŸ“Š Statistics System Test"),
            new Label("âœ… JavaFX Runtime: Working"),
            new Label("âœ… Gradle Build: Success"),
            new Label("âœ… Oracle JDK 17: Compatible"),
            new Label(""),
            new Label("ğŸ¯ Environment Status:"),
            new Label("â€¢ JavaFX: " + System.getProperty("javafx.version", "17.0.2")),
            new Label("â€¢ Java: " + System.getProperty("java.version")),
            new Label("â€¢ OS: " + System.getProperty("os.name")),
            new Label(""),
            new Label("ğŸ“ Next Steps:"),
            new Label("1. Add StatisticsController"),
            new Label("2. Add FXML files"),
            new Label("3. Test complete features"),
            new Label(""),
            new Label("Close window to finish test")
        );
        
        root.setStyle("-fx-padding: 25; -fx-alignment: center; -fx-spacing: 8;");
        
        Scene scene = new Scene(root, 480, 400);
        primaryStage.setTitle("ğŸ“Š Statistics Test - JavaFX Runtime OK");
        primaryStage.setScene(scene);
        primaryStage.setResizable(false);
        primaryStage.show();
        
        primaryStage.setOnCloseRequest(e -> {
            System.out.println("âœ… Test completed successfully!");
            System.out.println("ğŸ“Š JavaFX runtime is working correctly.");
        });
    }

    public static void main(String[] args) {
        System.out.println("Starting Statistics System Test...");
        System.out.println("Java Version: " + System.getProperty("java.version"));
        System.out.println("JavaFX Version: " + System.getProperty("javafx.version", "17.0.2"));
        launch(args);
    }
}'''

        println "âœ… Created clean test file: $testFile"
        println "ğŸ¯ Ready for JavaFX testing!"
    }
}

// JavaFX ëŸ°íƒ€ì„ ì„¤ì •
run {
    jvmArgs = [
            '--module-path', sourceSets.main.runtimeClasspath.asPath,
            '--add-modules', 'javafx.controls,javafx.fxml,javafx.graphics,javafx.base'
    ]
}

// JAR ë¹Œë“œ ì„¤ì •
jar {
    archiveBaseName = 'smart-file-manager'

    manifest {
        attributes(
                'Main-Class': 'com.smartfilemanager.Launcher',
                'Implementation-Version': version
        )
    }
}

// Shadow JAR ì„¤ì • (Fat JAR ìƒì„±)
shadowJar {
    archiveBaseName = 'Smart-File-Manager'
    archiveClassifier = ''
    archiveVersion = ''
    
    // ë©”ì¸ í´ë˜ìŠ¤ ì„¤ì •
    manifest {
        attributes(
                'Main-Class': 'com.smartfilemanager.Launcher',
                'Implementation-Version': version,
                'Implementation-Title': 'Smart File Manager',
                'Implementation-Vendor': 'Smart File Manager Team'
        )
    }
    
    // ì¤‘ë³µ íŒŒì¼ ì²˜ë¦¬ ì „ëµ
    mergeServiceFiles()
    
    // ì œì™¸í•  íŒŒì¼ë“¤ (ë¶ˆí•„ìš”í•œ íŒŒì¼ ì œê±°ë¡œ í¬ê¸° ìµœì í™”)
    exclude 'META-INF/*.RSA'
    exclude 'META-INF/*.SF'
    exclude 'META-INF/*.DSA'
    exclude 'META-INF/maven/**'
    // module-info.classëŠ” JavaFX ëª¨ë“ˆ ë¡œë”©ì— í•„ìš”í•˜ë¯€ë¡œ ì œì™¸í•˜ì§€ ì•ŠìŒ
    
    // ìµœì¢… íŒŒì¼ëª…: Smart-File-Manager.jar
    destinationDirectory = file("$buildDir/libs")
}

// ë„ì›€ë§ íƒœìŠ¤í¬
task helpStatistics {
    group = 'help'
    description = 'í†µê³„ í…ŒìŠ¤íŠ¸ ì‚¬ìš©ë²• ì•ˆë‚´'

    doLast {
        println """
ğŸ§ª Statistics System Test Commands
${"=" * 40}

ğŸ”§ JavaFX Setup:
âœ… Oracle JDK 17 with separate JavaFX runtime
âœ… Gradle automatically downloads JavaFX 17.0.2
âœ… Cross-platform compatibility

ğŸ“Š Available Commands:

1. ê¸°ë³¸ í†µê³„ í…ŒìŠ¤íŠ¸:
   ./gradlew statisticsTest
   â†’ JavaFX í™˜ê²½ í™•ì¸ + ê¸°ë³¸ UI í…ŒìŠ¤íŠ¸

2. ë¹ ë¥¸ ê²€ì¦:
   ./gradlew quickStatsTest  
   â†’ ê²½ëŸ‰ í…ŒìŠ¤íŠ¸

3. íŒŒì¼ í™•ì¸:
   ./gradlew verifyStatisticsFiles
   â†’ í•„ìˆ˜ íŒŒì¼ í™•ì¸

4. í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±:
   ./gradlew createTestFile
   â†’ ê¹¨ë—í•œ í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±

5. ì „ì²´ ë¹Œë“œ:
   ./gradlew build
   â†’ í”„ë¡œì íŠ¸ ì»´íŒŒì¼

ğŸ’¡ Troubleshooting:
â€¢ JavaFX ì˜¤ë¥˜ â†’ Gradleì´ ìë™ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ
â€¢ ëª¨ë“ˆ ê²½ë¡œ ì˜¤ë¥˜ â†’ build.gradleì´ ìë™ ì„¤ì •
â€¢ ëŸ°íƒ€ì„ ì˜¤ë¥˜ â†’ JDK 17ê³¼ JavaFX 17 í˜¸í™˜ì„± í™•ì¸ë¨
        """
    }
}

// AI ë¶„ì„ ë°ëª¨ ì‹¤í–‰ (ìˆ˜ì •ëœ ë²„ì „)
task aiDemo(type: JavaExec) {
    group = 'demonstration'
    description = 'AI íŒŒì¼ ë¶„ì„ ë°ëª¨ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤ (API í‚¤ ë¶ˆí•„ìš”)'

    dependsOn 'compileJava', 'compileTestJava'

    classpath = sourceSets.main.runtimeClasspath + sourceSets.test.runtimeClasspath
    mainClass = 'com.smartfilemanager.test.AIAnalysisDemo'

    // í†µê³„ í…ŒìŠ¤íŠ¸ì™€ ë™ì¼í•œ JavaFX ì„¤ì • ì‚¬ìš©
    jvmArgs = [
            '--module-path', classpath.asPath,
            '--add-modules', 'javafx.controls,javafx.fxml,javafx.graphics,javafx.base',
            '-Dfile.encoding=UTF-8',
            '-Djava.awt.headless=false'
    ]

    doFirst {
        println ""
        println "ğŸ¤– AI Analysis Demo"
        println "=" * 40
        println "ğŸ”§ JavaFX: Same settings as statisticsTest"
        println "ğŸ¯ ì‹¤ì œ API í‚¤ ì—†ì´ AI ë¶„ì„ ê¸°ëŠ¥ ì²´í—˜"
        println "ğŸ“ ë‹¤ì–‘í•œ íŒŒì¼ëª…ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥"
        println ""
    }

    doLast {
        println ""
        println "ğŸ‰ AI ë°ëª¨ ì™„ë£Œ!"
        println "ì‹¤ì œ AI ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ OpenAI API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤."
    }
}

// AI ë°ëª¨ íŒŒì¼ ìƒì„±
task createAIDemo {
    group = 'build setup'
    description = 'AI ë¶„ì„ ë°ëª¨ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤'

    doLast {
        def demoDir = file('src/test/java/com/smartfilemanager/test')
        demoDir.mkdirs()

        def demoFile = file('src/test/java/com/smartfilemanager/test/AIAnalysisDemo.java')
        if (demoFile.exists()) {
            println "â„¹ï¸  AI ë°ëª¨ íŒŒì¼ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤: $demoFile"
        } else {
            // ì—¬ê¸°ì— ìœ„ì˜ AIAnalysisDemo.java ë‚´ìš©ì„ ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤
            println "âœ… AI ë°ëª¨ íŒŒì¼ì„ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•´ì£¼ì„¸ìš”: $demoFile"
        }
    }
}

// ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ í…ŒìŠ¤íŠ¸
task monitoringTest(type: JavaExec) {
    group = 'verification'
    description = 'ì‹¤ì‹œê°„ í´ë” ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤'

    dependsOn 'compileJava', 'compileTestJava'

    classpath = sourceSets.main.runtimeClasspath + sourceSets.test.runtimeClasspath
    mainClass = 'com.smartfilemanager.test.MonitoringSystemTest'

    jvmArgs = [
            '--module-path', classpath.asPath,
            '--add-modules', 'javafx.controls,javafx.fxml,javafx.graphics,javafx.base',
            '-Dfile.encoding=UTF-8',
            '-Djava.awt.headless=false'
    ]

    systemProperties = [
            'test.mode': 'monitoring',
            'test.folder': System.getProperty("user.home") + "/Downloads"
    ]

    doFirst {
        println ""
        println "ğŸ” Smart File Manager - ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ í…ŒìŠ¤íŠ¸"
        println "=" * 55
        println "ğŸ“ ëª¨ë‹ˆí„°ë§ í´ë”: ${systemProperties['test.folder']}"
        println "ğŸ¯ íŒŒì¼ì„ í´ë”ì— ì¶”ê°€í•˜ë©´ ìë™ìœ¼ë¡œ ê°ì§€ë©ë‹ˆë‹¤"
        println "âš¡ ìë™ ì •ë¦¬ ê¸°ëŠ¥ë„ í•¨ê»˜ í…ŒìŠ¤íŠ¸ë©ë‹ˆë‹¤"
        println ""
    }

    doLast {
        println ""
        println "ğŸ‰ ëª¨ë‹ˆí„°ë§ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!"
        println "ì‹¤ì œ ì‚¬ìš© ì‹œì—ëŠ” ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ëª¨ë‹ˆí„°ë§ ë²„íŠ¼ì„ ì‚¬ìš©í•˜ì„¸ìš”."
    }
}

// ëª¨ë“  ë°ëª¨ ì‹¤í–‰
task runAllDemos {
    group = 'demonstration'
    description = 'ëª¨ë“  ë°ëª¨ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤'

    dependsOn 'statisticsTest', 'aiDemo'

    doLast {
        println ""
        println "ğŸ‰ ëª¨ë“  ë°ëª¨ ì‹¤í–‰ ì™„ë£Œ!"
        println "1. í†µê³„ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ âœ…"
        println "2. AI ë¶„ì„ ë°ëª¨ âœ…"
    }
}

// ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ (ëª¨ë‹ˆí„°ë§ í¬í•¨)
task runApp(type: JavaExec) {
    group = 'application'
    description = 'ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤ (ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ í¬í•¨)'

    dependsOn 'compileJava'

    classpath = sourceSets.main.runtimeClasspath
    mainClass = 'com.smartfilemanager.SmartFileManagerApp'

    jvmArgs = [
            '--module-path', classpath.asPath,
            '--add-modules', 'javafx.controls,javafx.fxml,javafx.graphics,javafx.base',
            '-Dfile.encoding=UTF-8'
    ]

    doFirst {
        println ""
        println "ğŸš€ Smart File Manager ì‹¤í–‰"
        println "=" * 40
        println "âœ… ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ í¬í•¨"
        println "âœ… í†µê³„ ì‹œìŠ¤í…œ í¬í•¨"
        println "âœ… AI ë¶„ì„ ë°ëª¨ í¬í•¨"
        println ""
    }
}

// í´ë¦°ì—…
clean {
    delete 'build'
    delete '.gradle'
}

// ===============================
// ë°°í¬ìš© íƒœìŠ¤í¬ë“¤
// ===============================

// Fat JAR ë¹Œë“œ (ë©”ì¸ íƒœìŠ¤í¬)
task buildExecutableJar {
    group = 'distribution'
    description = 'ì‹¤í–‰ ê°€ëŠ¥í•œ Fat JAR íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤'
    
    dependsOn shadowJar
    
    doLast {
        def jarFile = file("$buildDir/libs/Smart-File-Manager.jar")
        if (jarFile.exists()) {
            println ""
            println "ğŸ‰ ì‹¤í–‰ ê°€ëŠ¥í•œ JAR íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!"
            println "ğŸ“ ìœ„ì¹˜: ${jarFile.absolutePath}"
            println "ğŸ“ í¬ê¸°: ${jarFile.length() / (1024 * 1024)} MB"
            println ""
            println "ğŸš€ ì‹¤í–‰ ë°©ë²•:"
            println "1. ë”ë¸”í´ë¦­ìœ¼ë¡œ ì‹¤í–‰"
            println "2. ë˜ëŠ” ëª…ë ¹ì–´: java -jar Smart-File-Manager.jar"
            println ""
        } else {
            println "âŒ JAR íŒŒì¼ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
        }
    }
}

// ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
task createRunScripts {
    group = 'distribution'
    description = 'ì‹¤í–‰ ë³´ì¡° ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤'
    
    dependsOn shadowJar
    
    doLast {
        // Windows ë°°ì¹˜ íŒŒì¼ ìƒì„±
        def batFile = file("$buildDir/libs/run.bat")
        batFile.text = '''@echo off
echo Smart File Manager ì‹¤í–‰ ì¤‘...
echo.

:: Java ì„¤ì¹˜ í™•ì¸
java -version >nul 2>&1
if %errorlevel% neq 0 (
    echo âŒ Javaê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
    echo.
    echo Java 17 ì´ìƒì„ ì„¤ì¹˜í•´ì£¼ì„¸ìš”:
    echo https://adoptium.net/
    echo.
    pause
    exit /b 1
)

:: JAR íŒŒì¼ ì¡´ì¬ í™•ì¸
if not exist "Smart-File-Manager.jar" (
    echo âŒ Smart-File-Manager.jar íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
    echo.
    pause
    exit /b 1
)

:: ì‹¤í–‰
echo âœ… Smart File Manager ì‹œì‘...
java -jar Smart-File-Manager.jar

if %errorlevel% neq 0 (
    echo.
    echo âŒ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
    echo Java ë²„ì „ì„ í™•ì¸í•´ì£¼ì„¸ìš” (Java 17 ì´ìƒ í•„ìš”)
    echo.
    pause
)
'''

        // Linux/Mac ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
        def shFile = file("$buildDir/libs/run.sh")
        shFile.text = '''#!/bin/bash

echo "Smart File Manager ì‹¤í–‰ ì¤‘..."
echo

# Java ì„¤ì¹˜ í™•ì¸
if ! command -v java &> /dev/null; then
    echo "âŒ Javaê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
    echo
    echo "Java 17 ì´ìƒì„ ì„¤ì¹˜í•´ì£¼ì„¸ìš”:"
    echo "https://adoptium.net/"
    echo
    read -p "ê³„ì†í•˜ë ¤ë©´ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”..."
    exit 1
fi

# JAR íŒŒì¼ ì¡´ì¬ í™•ì¸
if [ ! -f "Smart-File-Manager.jar" ]; then
    echo "âŒ Smart-File-Manager.jar íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    echo
    read -p "ê³„ì†í•˜ë ¤ë©´ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”..."
    exit 1
fi

# ì‹¤í–‰
echo "âœ… Smart File Manager ì‹œì‘..."
java -jar Smart-File-Manager.jar

if [ $? -ne 0 ]; then
    echo
    echo "âŒ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
    echo "Java ë²„ì „ì„ í™•ì¸í•´ì£¼ì„¸ìš” (Java 17 ì´ìƒ í•„ìš”)"
    echo
    read -p "ê³„ì†í•˜ë ¤ë©´ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”..."
fi
'''
        
        // ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬ (Linux/Mac)
        if (!System.getProperty('os.name').toLowerCase().contains('windows')) {
            shFile.setExecutable(true)
        }
        
        println "âœ… ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤:"
        println "   - ${batFile.absolutePath} (Windowsìš©)"
        println "   - ${shFile.absolutePath} (Linux/Macìš©)"
    }
}

// README íŒŒì¼ ìƒì„±
task createReadme {
    group = 'distribution'
    description = 'ì‹¤í–‰ ì•ˆë‚´ README íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤'
    
    doLast {
        def readmeFile = file("$buildDir/libs/README.txt")
        readmeFile.text = '''ğŸ—‚ï¸ Smart File Manager - ì‹¤í–‰ ì•ˆë‚´
========================================

ğŸ“‹ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­:
â€¢ Java 17 ì´ìƒ ì„¤ì¹˜ í•„ìš”
â€¢ Windows 10/11, macOS 10.14+, Ubuntu 18.04+ ì§€ì›
â€¢ ìµœì†Œ 4GB RAM, 100MB ë””ìŠ¤í¬ ê³µê°„

ğŸš€ ì‹¤í–‰ ë°©ë²•:

ë°©ë²• 1: ë”ë¸”í´ë¦­ ì‹¤í–‰ (ê°€ì¥ ê°„ë‹¨)
â€¢ Smart-File-Manager.jar íŒŒì¼ì„ ë”ë¸”í´ë¦­

ë°©ë²• 2: ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©
â€¢ Windows: run.bat ë”ë¸”í´ë¦­
â€¢ Linux/Mac: í„°ë¯¸ë„ì—ì„œ ./run.sh ì‹¤í–‰

ë°©ë²• 3: ëª…ë ¹ì¤„ ì‹¤í–‰
â€¢ í„°ë¯¸ë„/ëª…ë ¹ í”„ë¡¬í”„íŠ¸ì—ì„œ:
  java -jar Smart-File-Manager.jar

ğŸ”§ ë¬¸ì œ í•´ê²°:

Q: ë”ë¸”í´ë¦­í•´ë„ ì‹¤í–‰ë˜ì§€ ì•Šì•„ìš”
A: Javaê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”
   https://adoptium.net/ ì—ì„œ ë‹¤ìš´ë¡œë“œ

Q: "ëª¨ë“ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" ì˜¤ë¥˜
A: Java 11 ì´ìƒì´ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”

Q: í•œê¸€ì´ ê¹¨ì ¸ ë³´ì—¬ìš”
A: ì‹œìŠ¤í…œ ì–¸ì–´ ì„¤ì •ì„ í™•ì¸í•˜ê±°ë‚˜ 
   ì‹¤í–‰ ì‹œ -Dfile.encoding=UTF-8 ì˜µì…˜ ì¶”ê°€

ğŸ“ ì§€ì›:
â€¢ GitHub: https://github.com/balsohn/smart-file-manager
â€¢ ë¬¸ì œ ì‹ ê³ : GitHub Issues íƒ­ ì´ìš©

Â© 2024 Smart File Manager Team
'''
        
        println "âœ… README íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: ${readmeFile.absolutePath}"
    }
}

// ì „ì²´ ë°°í¬ íŒ¨í‚¤ì§€ ìƒì„±
task createDistribution {
    group = 'distribution'
    description = 'ì™„ì „í•œ ë°°í¬ íŒ¨í‚¤ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤'
    
    dependsOn buildExecutableJar, createRunScripts, createReadme
    
    doLast {
        println ""
        println "ğŸ‰ ë°°í¬ íŒ¨í‚¤ì§€ ìƒì„± ì™„ë£Œ!"
        println "ğŸ“ ìœ„ì¹˜: $buildDir/libs/"
        println ""
        println "ğŸ“¦ í¬í•¨ëœ íŒŒì¼ë“¤:"
        println "â€¢ Smart-File-Manager.jar - ë©”ì¸ ì‹¤í–‰ íŒŒì¼"
        println "â€¢ run.bat - Windows ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸"
        println "â€¢ run.sh - Linux/Mac ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸"  
        println "â€¢ README.txt - ì‹¤í–‰ ì•ˆë‚´ì„œ"
        println ""
        println "ğŸš€ ì´ì œ libs í´ë”ë¥¼ ì••ì¶•í•´ì„œ ë°°í¬í•˜ì„¸ìš”!"
    }
}

// ===============================
// ë„¤ì´í‹°ë¸Œ ë°°í¬ íƒœìŠ¤í¬ë“¤ (jpackage)
// ===============================

// Windows EXE íŒŒì¼ ìƒì„±
task createWindowsExe {
    group = 'distribution'
    description = 'Windows EXE ì‹¤í–‰ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤'
    
    dependsOn shadowJar
    
    doLast {
        def jpackageCmd = [
            '"C:\\Program Files\\Java\\jdk-17\\bin\\jpackage.exe"',
            '--input', '"' + file("$buildDir/libs").absolutePath + '"',
            '--main-jar', 'Smart-File-Manager.jar',
            '--main-class', 'com.smartfilemanager.Launcher',
            '--name', 'SmartFileManager',
            '--app-version', version,
            '--description', '"AI ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ íŒŒì¼ ì •ë¦¬ ë„êµ¬"',
            '--vendor', '"Smart File Manager Team"',
            '--copyright', '"Â© 2024 Smart File Manager Team"',
            '--icon', '"' + file('src/main/resources/app_icon.ico').absolutePath + '"',
            '--dest', '"' + file("$buildDir/exe").absolutePath + '"',
            '--type', 'app-image'
        ]
        
        println "ğŸ”§ Windows EXE íŒŒì¼ ìƒì„± ì¤‘..."
        println "ëª…ë ¹ì–´: " + jpackageCmd.join(' ')
        
        def result = exec {
            commandLine 'cmd', '/c', jpackageCmd.join(' ')
            ignoreExitValue = true
        }
        
        if (result.exitValue == 0) {
            println "âœ… Windows EXE íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!"
            println "ğŸ“ ìœ„ì¹˜: $buildDir/exe/"
        } else {
            println "âŒ EXE íŒŒì¼ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
        }
    }
}

// Windows MSI ì„¤ì¹˜ íŒŒì¼ ìƒì„±
task createWindowsMsi {
    group = 'distribution'
    description = 'Windows MSI ì„¤ì¹˜ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤'
    
    dependsOn shadowJar
    
    doLast {
        def jpackageCmd = [
            '"C:\\Program Files\\Java\\jdk-17\\bin\\jpackage.exe"',
            '--app-image', '"' + file("$buildDir/exe/SmartFileManager").absolutePath + '"',
            '--name', 'SmartFileManager',
            '--app-version', version,
            '--description', '"AI ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ íŒŒì¼ ì •ë¦¬ ë„êµ¬"',
            '--vendor', '"Smart File Manager Team"',
            '--copyright', '"Â© 2024 Smart File Manager Team"',
            '--dest', '"' + file("$buildDir/msi").absolutePath + '"',
            '--type', 'msi',
            '--win-shortcut',
            '--win-menu',
            '--win-dir-chooser'
        ]
        
        println "ğŸ”§ Windows MSI ì„¤ì¹˜ íŒŒì¼ ìƒì„± ì¤‘..."
        println "ëª…ë ¹ì–´: " + jpackageCmd.join(' ')
        
        def result = exec {
            commandLine 'cmd', '/c', jpackageCmd.join(' ')
            ignoreExitValue = true
        }
        
        if (result.exitValue == 0) {
            println "âœ… Windows MSI ì„¤ì¹˜ íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!"
            println "ğŸ“ ìœ„ì¹˜: $buildDir/msi/"
        } else {
            println "âŒ MSI íŒŒì¼ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
        }
    }
}

// ëª¨ë“  ë°°í¬ íŒŒì¼ ìƒì„±
task createAllDistributions {
    group = 'distribution'
    description = 'ëª¨ë“  ë°°í¬ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤ (JAR, EXE, MSI)'
    
    dependsOn createDistribution, createWindowsExe, createWindowsMsi
    
    doLast {
        println ""
        println "ğŸ‰ ëª¨ë“  ë°°í¬ íŒŒì¼ ìƒì„± ì™„ë£Œ!"
        println ""
        println "ğŸ“¦ ìƒì„±ëœ íŒŒì¼ë“¤:"
        println "1. JAR íŒŒì¼: $buildDir/libs/Smart-File-Manager.jar"
        println "2. EXE íŒŒì¼: $buildDir/exe/"
        println "3. MSI ì„¤ì¹˜ íŒŒì¼: $buildDir/msi/"
        println ""
        println "ğŸš€ ë°°í¬ ì¤€ë¹„ ì™„ë£Œ!"
    }
}